# Wisdom Chain和比特币的交易模型长啥样？

*从代码层面为你揭露区块链的交易模型*


“交易”是区块链技术中非常重要的概念，各方之间的交易促成了交易网络的形成，支撑着整个网络的价值。现实世界中的“交易”是指**交易双方以货币及服务为媒介的价值的交换**，区块链中的交易虽然也有交易双方，但交易的基本结构并不像现实中那么明确，不论是UTXO，还是Account模型，想要确切理解他们对于初学者而言稍显困难。幸运的是，许多开源项目的源代码中都确切体现出了交易的基本组成结构，从代码层面进行学习会比阅读抽象的文字更加容易理解，这篇文章将以比特币、Wisdom Chain的源代码为例子，为大家展现这些项目的交易模型细节。


### 比特币的交易模型

比特币的交易模型为UTXO（Unspend Transaction Output未花费的交易输出）结构，抽象地讲，UTXO结构就像生活中去小卖铺用现金购买物品一样，钱包里的钞票就是你所拥有的UTXO，购买过程中涉及到凑钱（将多个UTXO凑成一个，或者直接用一个UTXO支付），支付（将UTXO作为输入），找零（将多给的钱以UTXO形式再发回来）。在代码层面，比特币的交易结构表现为如下情况：

!(BitcoinTX)[https://github.com/Cyanglacier/WIPs/raw/master/assets/WIP-2/Pictures/Bitcoin%20TX.PNG]

比特币的交易结构相对复杂，这个例子里我们可以轻松的看到比特币的交易结构组成

+ txid与hash：代表着本次交易的哈希值，可以用来对该交易进行定位

+ version：代表着发起交易时的版本号。由于比特币存在硬分叉升级的情况，如果版本号过低，交易是不会被其他矿工所接受的。

+ size、weight与locktime：size是本次交易（不包含hash）的大小，weight则是交易被包含的区块高度，locktime则指的是该交易会在多少区块被发送到网络中，一般为0（代表着立即发送交易）

+ vin：代表着交易的输入，也就是将要花费的UTXO。在交易构建时交易发起方需要从UTXO集中找到相应的UTXO。其中txid为该UTXO的哈希值，vout代表着该UTXO尚未被消费(其值为0)，而scriptSig则是交易发起者对该UTXO的签名，矿工在收到交易时需要对签名进行核对。至于sequence，它是早期比特币的一项数值，曾被用作“替代”操作，但目前“替代”操作已经被禁用了，sequnence的值将不会被纳入到交易中。

+ vout：该项为交易的输出，一般会包括两类输出：发送给他人的交易和发送给自己的找零交易。这个例子中，第一个交易为发送给他人的交易，其中value代表着交易额，n为交易序号，scriptPubkey则为交易的脚本（在比特币中，交易也可以看作一种被执行的“脚本”），其中包括了：签名asm，输出的十六进制码hex，签名数量reqSigs，交易类型type（这里是向公钥哈希进行交易，被称作PaytoPubkeyHash），以及交易接收方的地址addresses。第二个交易则为找零交易，大部分类容同第一个交易，不同的是该交易还附带了额外的信息，asm中有操作码OP_RETURN，代表着该交易并不会被执行，其后的十六进制码则是本次交易附带的信息。

比特币的UTXO结构虽然常常被认为很“简单”，不过由于代码编写的年代相对久远，在代码层面表述起来反而比许多区块链项目要复杂。另外，比特币的交易结构注定了其很难执行一些比较复杂的逻辑，或者说“合约”，想要更高的灵活性就必须使用layer2方案，但闪电网络等项目推进的缓慢变相证明了layer2技术目前还处于初期，尚不具备大规模应用的前提。


### Wisdom Chain的交易模型

Wisdom Chain和比特币类似，均采用了UTXO结构作为交易的基本框架，不过不同点在于，在JAVA语言的基础上，结合近10年区块链技术的发展积累，Wisdom Chain的交易模型相比比特币更加简洁。另一方面硬编码的各种事务规则可以视为适用于UTXO结构的智能合约（一般来说，由于传统UTXO结构缺乏世界状态树的更新，普遍认为以太坊的智能合约很难应用到传统UTXO中），不需要layer2方案也可以确保项目具备灵活性，可以适用于各种复杂的场景之中。Wisdom Chain的交易结构在代码层面可以表达为：

!(WisdomChainTX)[https://github.com/Cyanglacier/WIPs/raw/master/assets/WIP-2/Pictures/Wisdom%20Chain%20TX.PNG]

对比比特币，结构上精简了许多。交易中的各项数值定义如下：

+ version：版本号，类似比特币中的version，用来核对发起交易的客户端版本，如果区块链进行了硬分叉升级，旧版本的交易将不会被矿工打包。

+ type：交易类型。Wisdom Chain中的交易可以看作是一种“事务”，既然是事务就有诸多定义，Wisdom Chain中最常见的交易类型包括：Coinbase交易（用于挖掘出新区块时奖励矿工），转账交易，投票，发行代币，提取利息等等。交易类型不同，交易的结构也会有所差别，具体的交易类型种类如下：

!(WisdomChainTXType)[https://github.com/Cyanglacier/WIPs/raw/master/assets/WIP-2/Pictures/WDC%E4%BA%A4%E6%98%93%E7%B1%BB%E5%9E%8B.PNG]


+ nonce：随机数，一般用来对交易进行排序，避免发起重复交易。在挖矿中，区块的nonce则代表着矿工执行工作量证明的参数。

+ from与to：from为交易的发起方，而to则为交易的接收方。

+ amount与gasPrice：amount为本次交易的代币数量，一般以WDC作为货币单位，而gasPrice则是本次交易支付给矿工的手续费。

+ signature：签名，代表着交易发起方的签名，当交易被正确的交易发起方署名后该交易才会被矿工所认可。

+ payload：类似于比特币中OP_RETURN操作码，payload允许交易发起方在交易中带入一定的数据。但和比特币不同的是，payload中的数据可以被网络所识别并执行，如果payload中的内容符合规则编程中硬编码好的代码规则，那么其将作为相应的事务被执行。比特币的OP_RETURN操作码并不会自动执行其中的内容。

得益于区块链技术的积累，作为后辈的Wisdom Chain在代码结构上相比前辈比特币精简了许多，并且比特币能做到的Wisdom Chain也能做到。精简的代码也意味着在实际使用中更少地出现BUG以及更方便地阅读和使用。


### 结语

区块链技术已经不再是一项单纯的“金融手段”了，不论是企业还是国家，都在不断重视区块链技术的发展与推广应用，如果还抱着“炒币不需要了解技术”的心态，恐怕会在不久后落后于时代吧。交易是区块链的基础，交易结构也决定了区块链项目能在哪些领域进行应用，良好的交易结构不仅可以让相应项目在更多领域得到应用，还能有效降低开发者的准入门槛，吸引更多的开发者为区块链项目提供技术支持，实现经济价值的正循环。从这个角度来说，了解区块链项目的交易结构还是很有必要的。

> 经济由几个简单的零部件和无数次重复的简单交易组成——瑞·达利欧
