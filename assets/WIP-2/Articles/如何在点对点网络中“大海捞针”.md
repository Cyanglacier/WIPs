# 如何在点对点网络中“大海捞针”


*简单介绍Kademlia原理*


### 前言


如果有人突然问你："怎么快速从人群中定位一个人？"你可能会一头雾水，人群茫茫多，两三个人还好，想要在一大堆人里精准的定位一个人就如同大海捞针一般困难，这个难题也是点对点网络所要面对的。在点对点网络中，网络中的所有节点在其他节点看来都是类似的，如果要和其中某个节点进行通讯，必要步骤之一就是定位到你想要通讯的节点。不过还好，计算机技术的发展让这个难题有了解决方案，从最早的中心化服务器解决办法，再到Tapestry、Chord，又发展到Kademila，Discv，基于分布式哈希表DHT的点对点网络技术为我们从茫茫节点中精准定位提供了富有美感的解决方案。这篇文章我们就以经典的Kademlia技术为例子，了解一下点对点网络中是如何进行定位与通信的吧。


### 异或运算XOR


在开始之前，我们需要了解计算机中一种重要的位运算方式——XOR异或运算。所谓异或运算，是指在二进制位中计算结果的一种运算方式，其特点在于只有位的输入值不同的时候，输出结果才会是True（在二进制中表示为1），相同的输入位则输出False（二进制中表示为0）。用二进制表达会更加简单明了：
<br>数字100的二进制表示是1100100，而数字123用二进制表达则为1111011，我们对1100100和1111011进行XOR异或运算，其结果则为：<br>

```
XOR
1100100
1111011
---
0011111
```

上述公式中，1100100和1111011的XOR异或运算结果为0011111，十进制表达为31。异或运算是非常重要的逻辑函数，在Kadmlia中被用作计算节点与节点之间的距离，并根据距离对节点进行分类。接下来我们将继续了解Kademlia的工作原理。


### Kademlia的网络拓补结构


在Kademlia中，进入网络的每一个节点都会被分配一个独一无二的节点ID，节点ID以二进制的形式表示，原始Kadmlia协议中使用160位二进制数作为节点ID。任意两个节点的距离可以通过XOR异或运算轻松得出，即节点间距离=A的ID XOR B的ID。由于Kadmlia采用二进制表示节点的ID，故其网络结构也可以表达为二叉树结构。如下图所示：

！[KademliaTree]()

上图中我们模拟了
